## 📌 Giới thiệu
Socket là nền tảng của lập trình mạng trong Java. Nó cung cấp cơ chế giao tiếp hai chiều giữa client và server thông qua TCP/IP. Trong bài này, mình sẽ hướng dẫn các bạn xây dựng một hệ thống Echo đơn giản để hiểu rõ cách Socket hoạt động.

## 🎯 Mục tiêu học
- Hiểu khái niệm Socket và ServerSocket trong Java
- Tạo server lắng nghe kết nối trên một cổng cụ thể
- Xây dựng client kết nối và trao đổi dữ liệu với server
- Xử lý luồng dữ liệu vào/ra (InputStream/OutputStream)

## 🔧 Hướng dẫn thực hiện

### Bước 1: Tạo Server
Server sẽ lắng nghe trên cổng 5000 và chờ kết nối từ client:

Dưới đây là một ví dụ server đơn giản (blocking I/O) để minh họa các bước cơ bản.

```java
import java.net.*;
import java.io.*;

public class EchoServer {
	public static void main(String[] args) {
		try (ServerSocket server = new ServerSocket(5000)) {
			System.out.println("Server đang chờ kết nối...");

			while (true) {
				Socket client = server.accept();
				System.out.println("Client đã kết nối: " + client.getInetAddress());

				// Xử lý client trong một thread đơn giản
				new Thread(() -> {
					try (
						BufferedReader in = new BufferedReader(new InputStreamReader(client.getInputStream()));
						PrintWriter out = new PrintWriter(client.getOutputStream(), true)
					) {
						String line;
						while ((line = in.readLine()) != null) {
							System.out.println("Server nhận: " + line);
							out.println("Echo: " + line);
						}
					} catch (IOException e) {
						e.printStackTrace();
					} finally {
						try { client.close(); } catch (IOException ignored) {}
					}
				}).start();
			}

		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
```

### Bước 2: Tạo Client (ví dụ)

```java
import java.net.*;
import java.io.*;

public class SimpleClient {
	public static void main(String[] args) throws Exception {
		try (Socket socket = new Socket("localhost", 5000);
				 BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
				 PrintWriter out = new PrintWriter(socket.getOutputStream(), true)) {

			out.println("Hello Server");
			System.out.println("Phản hồi từ server: " + in.readLine());
		}
	}
}
```

### Bước 3: Các lưu ý production

- Sử dụng thread pool (ExecutorService) để tránh tạo quá nhiều thread.
- Thiết lập timeout cho socket: `socket.setSoTimeout(…)`.
- Xử lý exception rõ ràng và log thông tin client (id/ip) để dễ gỡ lỗi.
- Với hiệu năng cao, cân nhắc NIO (Non-blocking I/O) hoặc Netty.

### Ví dụ nâng cao: Thread pool

```java
ExecutorService pool = Executors.newFixedThreadPool(20);
// ở chỗ accept(): pool.submit(() -> handleClient(client));
```

## 🧪 Bài tập thực hành
1. Mở rộng server để nhận nhiều client đồng thời và giữ log các message vào file.
2. Thêm tính năng broadcast: khi client A gửi, server gửi tới tất cả client khác.
3. Implement reconnection/backoff cho client khi server offline.

## 🎓 Kết luận
Trong bài này bạn đã nắm được:
- Cách tạo ServerSocket và Socket client cơ bản.
- Lưu ý về concurrency, thread pool và timeout.
- Khi nào nên dùng NIO/Netty cho production.

Tiếp theo: thử triển khai phiên bản non-blocking bằng Java NIO hoặc dùng Netty để so sánh hiệu năng.
\